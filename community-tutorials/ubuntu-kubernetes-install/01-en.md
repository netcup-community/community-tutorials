---
title: Install Kubernetes Ubuntu 20.04
description: Kubernetes on Ubuntu 20.04 as Singlenode-Cluster or Multinode-Cluster
updated_at: 2021-11-17
slug: ubuntu-kubernetes-install
author_name: Tobias LÃ¤pple
author_url: https://tobi-l.de
author_image: -
author_bio: -
tags: [shell,docker,ubuntu] 
netcup_product_url: https://www.netcup.de/bestellen/produkt.php?produkt=2631
language: en
available_languages: en
---

# Introduction
In this tutorial, i show you how you can install kubernetes
as a single-node-cluster or\
multi-node-cluster on Netcup RS.
We are also going to deploy a simple Nginx application.

# Requirements
A fresh installed Rootserver from Netcup with Ubuntu 20.04 LTS.\
For Hardwarerequirements i strongly reccomend the official kubernetes documentation:
- https://docs.kublr.com/installation/hardware-recommendation/

In this tutorial i'm going to use a RS 8000 G9
but it should work on the other RS series aswell.


# Step 1
Connect to the server as root.\
Add a user and add him to sudoers.
````
adduser myusername
````

````
usermod -aG sudo username
````

# Step 2
Login into the newly created user by entering
````
su - myusername
````

# Step 3 - Basic preperations
Time for updates:
````
sudo apt update && sudo apt upgrade
````

Install Docker via apt. 
````
sudo apt-get install docker.io
````

# Step 4 - Kubernetes preperation
First at all, we need to turn off the swap because it is a requirement of kubernetes.
````
sudo swapoff -a
````
Next we need to add some dependencies to out apt manager to be able to install kubernetes.
````
sudo sh -c "echo 'deb http://apt.kubernetes.io/ kubernetes-xenial main' >> /etc/apt/sources.list.d/kubernetes.list"
````

We also need to add the apt-key.
````
sudo sh -c "curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -"
````

After that, we need to update our apt so apt knows about our new added dependencies.
````
sudo apt update
````

# Step 4 - Install kubeadm, kubelet, kubectl
Next we need to install kubeadm, kubelet and kubectl.
Also very easy, one single command:
````
sudo apt install kubeadm kubelet kubectl -y
````

INFO:
In case you want to install a specific version of these tools you can tag it like this: kubeadm@1.19 for example

As we don't want that apt probably updates kubeadm kubelet and kubectl automaticly we set them on hold.
````
sudo apt-mark hold kubelet kubeadm kubectl
````

# Step 5 - Add daemon.json for docker
We need to create a additional file inside the docker folder.
````
vi /etc/docker/daemon.json
````

add following content to it and save it.
````
{
  "exec-opts": ["native.cgroupdriver=systemd"],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "100m"
  },
  "storage-driver": "overlay2"
}
````

# Step 6 - Init kubeadm
Now we need to init kubeadm.
Also one simple command
````
sudo kubeadm init --pod-network-cidr 192.168.0.0/16
````

Once finished (can take a while) you see in the log the next steps.
So:
````
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
````

You also see something like this:
````
kubeadm join <Your-IP-Address>:6443 --token xxxxxxx.xxxxxxxxxxxxxxxxx \
	--discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
````

i reccomend to save it somewhere where you can find it everytime you need it.

# Step 6 - Check if kubectl works
You should be able to use kubectl commands now.
````
$kubectl get node
NAME                   STATUS     ROLES                  AGE    VERSION
vxxxxxxxxxxxxxxxx   NotReady   control-plane,master   5m1s   v1.22.3  
````

If you see this, everything worked fine.
Next we apply calico for networking.

````
kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml
````
Wait about a minute and you should see the STATUS changing to Ready

kubectl get nodes
````
NAME                   STATUS     ROLES                  AGE    VERSION
vxxxxxxxxxxxxxxxx      Ready   control-plane,master   5m1s   v1.22.3  
````

# Next step depends if you want a multi-node-cluster or single-node-cluster

## Multinode
For every node repeat Step 1 - 4
When you are done, use your join command which you got from the Master installation.

Node 1 for example:
````
kubeadm join <Your-IP-Address>:6443 --token xxxxxxx.xxxxxxxxxxxxxxxxx \
	--discovery-token-ca-cert-hash sha256:xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
````

Now when you check "kubectl get node" on your master you see a node.

## Singlenode
We need to taint the master that he can create pods, services etc.
````
kubectl taint nodes --all node-role.kubernetes.io/master-
````

Now we are able to create pods, services etc on our master.

# Deploy Nginx example
Now we want to create a basic Nginx exposed via NodePort
We are going to start a nginx pod with 2 replicasets and also
a service which exposes the nginx pods via NodePort on Port 30007
So, create a file in a location of you choice.
I will call it nginx-basic.yml
````
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: nginx
spec:
  replicas: 2
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx-deployment
        image: nginx
---
apiVersion: v1
kind: Service
metadata:
  name: nginx-service
spec:
  type: NodePort
  selector:
    app: nginx
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80
      nodePort: 30007
````

now we need to apply the yml to cluster with following command:
flag -f is for a file. you also specify -f /some/path/to/yaml/nginx-basic.yml
````
kubectl apply -f nginx-basic.yml
````

now you can take a look at the pods by typing
````
kubectl get pods
````

You nginx should be avaivable at SERVER-IP:30007.

Happy Deploying! :)
